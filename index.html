<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            background: #000;
            color: #fff;
            font-family: 'VT323', monospace;
            font-size: 21px;
            line-height: 1.6;
            text-transform: uppercase;
            min-height: 100vh;
            padding: 24px 16px 48px;
            display: flex;
            justify-content: center;
        }

        #wrap { width: 100%; max-width: 380px; }

        /* Subtle random screen flicker */
        @keyframes crtFlicker {
            0%,96%,100% { opacity:1; }
            97%          { opacity:.75; }
            98%          { opacity:1; }
            99%          { opacity:.85; }
        }
        #wrap { animation: crtFlicker 11s infinite; }

        /* Screen flash on transition */
        @keyframes screenFlash {
            0%,100% { opacity:1; }
            20%     { opacity:0; }
            50%     { opacity:1; }
            70%     { opacity:0; }
            90%     { opacity:1; }
        }
        .flashing { animation: screenFlash 0.45s ease forwards; }

        .line { white-space: pre-wrap; min-height: 1.6em; }
        .sp   { height: 0.75em; }
        .green { color: #00ff00; }
        .red   { color: #ff3333; }
        .dim   { color: #555; }
        .sep   { color: #1e1e1e; letter-spacing: 0.05em; }

        .cursor::after {
            content: "_";
            animation: blink 0.5s step-end infinite;
        }
        @keyframes blink { 50% { opacity:0; } }

        /* Two-column layout */
        .trow     { display:flex; min-height:1.6em; }
        .trow .lbl { width:52%; flex-shrink:0; }
        .trow .val { flex:1; }

        /* Input rows */
        .inp-row { display:none; align-items:baseline; min-height:1.6em; }
        .inp-row.active { display:flex; }
        .inp-row .lbl   { width:52%; flex-shrink:0; }

        input[type=text],
        input[type=number],
        input[type=email] {
            background: transparent;
            border: none;
            border-bottom: 1px solid #2a2a2a;
            color: #00ff00;
            font-family: inherit;
            font-size: inherit;
            text-transform: uppercase;
            outline: none;
            padding: 0 2px;
            flex: 1;
            width: 100%;
            caret-color: #00ff00;
        }
        input::placeholder { color: #252525; text-transform:none; font-size:.78em; }
        input:focus        { border-bottom-color: #00ff00; }

        /* ── STYLE RANK ── */
        #rankWrap  { display:none; margin: 10px 0 5px; }
        .rank-row  { display:flex; align-items:baseline; gap:8px; }
        #rankLetter { font-size:2.8em; line-height:1; }
        #rankWord   { font-size:.85em; }
        .rank-d { color:#666; }
        .rank-c { color:#44aaff; }
        .rank-b { color:#bb44ff; }
        .rank-a { color:#ffcc00; }
        .rank-s { color:#ff3333; }

        /* ── PROGRESS ── */
        #progWrap { display:none; font-size:.85em; color:#00ff00; margin-bottom:4px; }
        #progTxt  { color:#444; }

        /* Hint */
        .hint    { display:none; color:#2e2e2e; font-size:.78em; padding:4px 0 2px; }

        /* Error */
        #errLine { display:none; color:#ff3333; padding:3px 0; }

        /* Submit */
        #subBtn {
            display: none;
            background: transparent;
            color: #00ff00;
            border: 1px solid #00ff00;
            padding: 13px;
            cursor: pointer;
            font-family: inherit;
            font-size: inherit;
            text-transform: uppercase;
            margin-top: 20px;
            width: 100%;
            letter-spacing: .08em;
        }
        #subBtn:active   { background:#00ff00; color:#000; }
        #subBtn:disabled { opacity:.35; cursor:default; }
    </style>
</head>
<body>
<div id="wrap">

    <!-- SCREEN 1: Boot -->
    <div id="terminal"></div>

    <!-- SCREEN 2: Status + Form -->
    <div id="statusSec" style="display:none;">

        <div id="rankWrap">
            <div class="dim" style="font-size:.8em; margin-bottom:2px;">COMBAT EFFICIENCY RATING</div>
            <div class="rank-row">
                <span id="rankLetter" class="rank-d">D</span>
                <span id="rankWord"   class="rank-d dim">— DESTRUCTIVE</span>
            </div>
        </div>

        <div id="progWrap">
            <span id="progBar">[□□□□]</span>
            <span id="progTxt"> 0/4 FIELDS CONFIRMED</span>
        </div>

        <div class="sp"></div>
        <div class="line sep">————————————————————————————</div>
        <div class="sp"></div>

        <div id="confirmedLines"></div>

        <div class="inp-row" id="row-name">
            <span class="lbl">YOUR NAME:</span>
            <input type="text"   id="f-name"  autocomplete="off" placeholder="enter name">
        </div>
        <div class="inp-row" id="row-age">
            <span class="lbl">YOUR AGE:</span>
            <input type="number" id="f-age"   min="1" max="120" autocomplete="off" placeholder="00">
        </div>
        <div class="inp-row" id="row-phone">
            <span class="lbl">PHONE NUMBER:</span>
            <input type="text"   id="f-phone" autocomplete="off" placeholder="+380...">
        </div>
        <div class="inp-row" id="row-email">
            <span class="lbl">EMAIL ADDRESS:</span>
            <input type="email"  id="f-email" autocomplete="off" placeholder="you@example.com">
        </div>

        <div class="hint" id="hintLine">[ PRESS ENTER TO CONFIRM FIELD ]</div>
        <div id="errLine"></div>

        <!-- Iconic trio -->
        <div id="iconicWrap" style="display:none;">
            <div class="sp"></div>
            <div class="line sep">————————————————————————————</div>
            <div class="sp"></div>
            <div id="iconicLines"></div>
            <div class="sp"></div>
        </div>

    </div>

    <button id="subBtn" onclick="submitData()">[ UPLOAD CALIBRATION DATA ]</button>
</div>

<script>
    const tg    = window.Telegram.WebApp;
    tg.expand();

    const term  = document.getElementById('terminal');
    const sleep = ms => new Promise(r => setTimeout(r, ms));

    async function type(text, cls = '', speed = 24, parent = term) {
        const d = document.createElement('div');
        d.className = 'line cursor' + (cls ? ' ' + cls : '');
        parent.appendChild(d);
        for (const ch of text) { d.textContent += ch; await sleep(speed); }
        d.classList.remove('cursor');
        return d;
    }

    function sp(parent = term) {
        const d = document.createElement('div'); d.className = 'sp'; parent.appendChild(d);
    }

    async function trow(lbl, val, valCls = 'green', delay = 300) {
        const d = document.createElement('div');
        d.className = 'trow';
        d.innerHTML = `<span class="lbl">${lbl}</span><span class="val ${valCls}"></span>`;
        term.appendChild(d);
        await sleep(delay);
        d.querySelector('.val').textContent = val;
    }

    // ── Boot sequence (matches screenshots exactly) ──
    async function runBoot() {
        await sleep(300);
        await type('BOOT UP SEQUENCE READY');
        sp();
        await type('FIRMWARE');
        await type('LATEST VERSION (2112.08.06)', 'green', 16);
        sp();
        await type('CALIBRATION');
        await type('  EXPIRED',                'red', 22);
        await type('  NEW CALIBRATION REQUIRED','red', 16);
        sp();
        await type('BEGINNING CALIBRATION...');
        sp();
        await trow('AUDIO',     'OK');
        await trow('VIDEO',     'OK');
        await trow('MECHANICS', 'OK');
        sp();
        await type('CALIBRATION COMPLETE',     'green', 18);
        await type('PRIMARY SETTINGS UPDATED', 'green', 16);
        await type('(ASSISTS AND OPTIONS AVAILABLE IN PAUSE MENU)', '', 10);
        sp();
        await type('ALL SYSTEMS OPERATIONAL', 'green', 18);
        await sleep(260);
        await type('LOADING STATUS UPDATE...', '', 20);
        await sleep(1000);

        // Flash → wipe → status screen
        document.getElementById('wrap').classList.add('flashing');
        await sleep(460);
        document.getElementById('wrap').classList.remove('flashing');
        term.innerHTML = '';
        await sleep(80);

        await type('STATUS UPDATE:');
        sp();
        await trow('LOCATION:',  'APPROACHING HELL', 'red',   200);
        await trow('OBJECTIVE:', 'REGISTRATION',     'green', 200);
        sp();

        document.getElementById('statusSec').style.display = 'block';
        document.getElementById('rankWrap').style.display  = 'block';
        document.getElementById('progWrap').style.display  = 'block';
        document.getElementById('hintLine').style.display  = 'block';
        showStep(0);
    }

    // ── Style rank (ULTRAKILL ranks: D→C→B→A→S) ──
    const RANKS = [
        { l:'D', cls:'rank-d', w:'— DESTRUCTIVE' },
        { l:'C', cls:'rank-c', w:'— COLD'        },
        { l:'B', cls:'rank-b', w:'— BRUTAL'       },
        { l:'A', cls:'rank-a', w:'— ANARCHIC'     },
        { l:'S', cls:'rank-s', w:'— SUPREME'      },
    ];
    const BARS = ['[□□□□]','[■□□□]','[■■□□]','[■■■□]','[■■■■]'];

    function updateRank(n) {
        const r  = RANKS[n];
        const rl = document.getElementById('rankLetter');
        const rw = document.getElementById('rankWord');
        rl.className = r.cls; rl.textContent = r.l;
        rw.className = r.cls + ' dim'; rw.textContent = r.w;
        document.getElementById('progBar').textContent = BARS[n];
        document.getElementById('progTxt').textContent = ` ${n}/4 FIELDS CONFIRMED`;
    }

    // ── Form ──
    const STEPS  = ['name','age','phone','email'];
    const LABELS = {
        name:  'YOUR NAME:',
        age:   'YOUR AGE:',
        phone: 'PHONE NUMBER:',
        email: 'EMAIL ADDRESS:'
    };
    let cur = 0;

    function showStep(i) {
        if (i >= STEPS.length) { finishForm(); return; }
        const row = document.getElementById('row-' + STEPS[i]);
        row.classList.add('active');
        setTimeout(() => document.getElementById('f-' + STEPS[i]).focus(), 60);
        document.getElementById('f-' + STEPS[i])
            .addEventListener('keydown', e => { if (e.key==='Enter') { e.preventDefault(); confirmStep(i); } });
    }

    function validate(step, val) {
        if (!val) return '! FIELD CANNOT BE EMPTY';
        if (step==='age'   && (isNaN(val)||+val<1||+val>120))
            return '! INVALID AGE (1–120)';
        if (step==='phone' && !/^\+?[\d\s\-]{7,16}$/.test(val))
            return '! INVALID PHONE FORMAT';
        if (step==='email' && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(val))
            return '! INVALID EMAIL FORMAT';
        return null;
    }

    function confirmStep(i) {
        const step = STEPS[i];
        const inp  = document.getElementById('f-' + step);
        const val  = inp.value.trim();
        const err  = validate(step, val);
        const el   = document.getElementById('errLine');

        if (err) {
            el.textContent = err; el.style.display = 'block';
            inp.focus();
            setTimeout(() => el.style.display = 'none', 3000);
            return;
        }
        el.style.display = 'none';
        inp.readOnly = true;
        document.getElementById('row-' + step).classList.remove('active');

        const cf = document.createElement('div');
        cf.className = 'trow';
        cf.innerHTML = `<span class="lbl">${LABELS[step]}</span>
                        <span class="val green">${val}</span>`;
        document.getElementById('confirmedLines').appendChild(cf);

        cur++;
        updateRank(cur);
        showStep(cur);
    }

    async function finishForm() {
        document.getElementById('hintLine').style.display = 'none';
        const iw = document.getElementById('iconicWrap');
        iw.style.display = 'block';
        const tgt = document.getElementById('iconicLines');
        await sleep(500);
        await type('MANKIND IS DEAD.', 'red', 65, tgt);
        await sleep(350);
        await type('BLOOD IS FUEL.',   'red', 65, tgt);
        await sleep(350);
        await type('HELL IS FULL.',    'red', 65, tgt);
        await sleep(450);
        document.getElementById('subBtn').style.display = 'block';
    }

    function submitData() {
        const data = {
            name:  document.getElementById('f-name').value,
            age:   document.getElementById('f-age').value,
            phone: document.getElementById('f-phone').value,
            email: document.getElementById('f-email').value
        };
        if (!data.name || !data.phone) return;
        const btn = document.getElementById('subBtn');
        btn.textContent = '[ UPLOADING... ]';
        btn.disabled = true;
        setTimeout(() => tg.sendData(JSON.stringify(data)), 900);
    }

    window.onload = runBoot;
</script>
</body>
</html>
